<!DOCTYPE html>
<html lang="en">

<head>
    <title>Totally Science</title>
    <!--Cache Killer-->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <script>
        const html = document.getElementsByTagName('head')[0].innerHTML;
        const title = document.getElementsByTagName('title')[0];


        /*const mainJS = document.createElement("script")
        mainJS.src = `assets/scripts/main.js?${new Date().getTime()}`
        title.insertAdjacentElement('afterend', mainJS)*/

        //title.insertAdjacentElement('afterend', accountJS)

        //const mainCSS = `<link rel='stylesheet' href='assets/styles/main.css?${new Date().getTime()}'>`
        //const preferencesCSS = `<link rel='stylesheet' href='assets/styles/preferences.css?${new Date().getTime()}'>`

        //document.getElementsByTagName('head')[0].innerHTML += mainCSS + preferencesCSS
    </script>

    <link rel='stylesheet' href='./assets/styles/account.css'>
    <link rel='stylesheet' href='./assets/styles/main.css'>

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!--End Cache Killer-->

    <link rel="icon" href="./assets/images/logo.png">
    <!--Google Adsense-->
    <script data-ad-client="ca-pub-3486863589051210" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <link rel="stylesheet" href="./popups/modal.css">

    <style>
        #headerText {
            text-align: center;
        }
        
        #headerText h1 {
            color: red;
        }
        
        #mainButton {
            padding-top: 5vw;
            text-align: center;
        }
        
        #mainButton button {
            font-size: 2vw;
            width: 18vw;
            height: 4vw;
            color: var(--light-color);
            background-color: var(--accent-color);
            border: 0px;
            border-radius: 10px;
            margin-bottom: 2%;
            cursor: pointer;
        }
        
        #altText {
            text-align: center;
        }
        
        #altlink:hover {
            color: var(--accent-color);
        }
    </style>
</head>

<body id="body">
    <div id="navbar">
        <div id="leftbar">
        </div>
        <div id="middlebar">
            <p>Totally Science</p>
        </div>
        <div id="rightbar">
        </div>
    </div>

    <div style="padding-top: 90px;"></div>

    <div id="headerText">
        <h1 id="bookmarkText">Make sure you bookmark this tab by pressing CTRL + D</h1>
        <h2>This website will be updated with new links whenever they are created so <span style="color: var(--accent-color);"><b>Totally Science</b> never gets blocked</span>.</h2>
    </div>

    <div id="mainButton">
        <button onclick="enterNewLink()">Enter Newest Link</button>
    </div>
    <div id="altText">
        <p>Or see a list of <a id="altlink" href="">alternative links</a></p>
    </div>


    <script src="./assets/scripts/main.js?v6"></script>
    <script src="./popups/modal.js"></script>
</body>


<script>
    bookmarkKeys();

    function enterNewLink() {
        if (localStorage.getItem("bookmark") == null) {
            openInfoModal('Make sure you bookmark the page!');
            localStorage.setItem("bookmark", "true")
        } else {
            window.open("http://totallyscience.co", "_self")
        }

    }

    function bookmarkKeys() {
        if (navigator.platform.indexOf('Mac') > -1) {
            document.getElementById("bookmarkText").innerText = "Make sure you bookmark this tab by pressing CMD + D"
        }
    }

    var _errtimer, link, href;

    function clickHandler() {
        //var frame = <iframe id='testframe' style='visibility:hidden;' src='https://totallyscience.co'></iframe>;
        var frame = document.createElement('iframe')
        frame.id = 'testframe'
        frame.src = 'https://totallyscience.co'
        frame.onload = 'console.log("Fuck you")'

        document.getElementById("body").append(frame);

        _errtimer = setTimeout(canAccessIFrame, 1000);

        //console.log(canAccessIFrame(frame))
        /*document.getElementById("testframe").on('load', function() {
            clearTimeout(_errtimer);
            console.log('frame loaded successfuly');
            location.href = href;
        });*/
    }

    function checkIframeLoaded() {
        // Get a handle to the iframe element
        var iframe = document.getElementById('testframe');
        var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

        // Check if loading is complete
        if (iframeDoc.readyState == 'complete') {
            //iframe.contentWindow.alert("Hello");
            iframe.contentWindow.onload = function() {
                alert("I am loaded");
            };
            // The loading is complete, call the function we want executed once the iframe is loaded
            //alert("I am loaded");
            //afterLoading();
            return;
        }

        // If we are here, it is not loaded. Set things up so we check   the status again in 100 milliseconds
        window.setTimeout(checkIframeLoaded, 100);
    }

    function afterLoading() {
        alert("I am here");
    }

    function frameError() {
        alert('error in frame');
    }

    clickHandler();

    function canAccessIFrame() {
        if (document.getElementById("testframe").contentWindow.document.getElementById('sections') != null) {
            console.log(true)
        } else {
            console.log(false)
        }
        //document.getElementById("testframe").contentWindow.postMessage("yo", 'https://totallyscience.co');
    }
    window.addEventListener('message', event => {
        alert(event)
            // IMPORTANT: check the origin of the data! 
        if (event.origin.startsWith('https://totallyscience.co')) {
            // The data was sent from your site.
            // Data sent with postMessage is stored in event.data:
            console.log(event.data);
        } else {
            console.log("notmywebsite");
            // The data was NOT sent from your site! 
            // Be careful! Do not use it. This else branch is
            // here just for clarity, you usually shouldn't need it.
            return;
        }
    });
</script>

</html>